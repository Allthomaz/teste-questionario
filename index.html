<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="deploy-timestamp" content="2026-02-05">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionário - Dr. Bruno Paschoalini</title>
    <!-- Bibliotecas para geração de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <!-- Incluindo Tailwind CSS para um design moderno e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados adicionais */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
        }
        
        /* Estilos para os radio buttons das perguntas de inflamação */
        .inflammation-radio input[type="radio"] {
            display: none;
        }
        
        .inflammation-radio label {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: 2px solid #d1d5db;
            background-color: white;
            color: #6b7280;
            font-weight: 500;
        }
        
        .inflammation-radio label:hover {
            background-color: #f9fafb;
            border-color: #9ca3af;
        }
        
        .inflammation-radio input[type="radio"]:checked + label {
            background-color: #10b981;
            border-color: #059669;
            color: white;
        }
        
        /* Estilos para os radio buttons das perguntas de saúde mental */
        .mental-radio input[type="radio"] {
            display: none;
        }
        
        .mental-radio label {
            padding: 8px 16px;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: 2px solid #d1d5db;
            background-color: white;
            color: #6b7280;
            font-weight: 500;
        }
        
        .mental-radio label:hover {
            background-color: #f9fafb;
            border-color: #9ca3af;
        }
        
        .mental-radio input[type="radio"]:checked + label {
            background-color: #10b981;
            border-color: #059669;
            color: white;
        }

        /* Animação suave entre passos */
        .step-content {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <!-- Cabeçalho -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Dr. Bruno Paschoalini</h1>
            <p class="text-xl text-gray-700 mt-2">Questionário de Inflamação e Risco Mental</p>
        </header>

        <!-- Barra de Progresso -->
        <div class="mb-8">
            <div class="flex justify-between mb-2 text-sm font-medium text-gray-600">
                <span>Progresso</span>
                <span id="progress-text">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div id="progress-bar" class="bg-cyan-600 h-2.5 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
        </div>

        <form action="https://formspree.io/f/mrbkybwj" method="POST" id="questionnaireForm">
            
            <!-- PASSO 1: Dados Pessoais -->
            <div id="step-1" class="step-content bg-white p-6 rounded-2xl shadow-sm mb-6">
                <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Passo 1: Seus Dados</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="nome" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo <span class="text-red-500">*</span></label>
                        <input type="text" id="nome" name="nome" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email <span class="text-red-500">*</span></label>
                        <input type="email" id="email" name="email" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition">
                    </div>
                    <div>
                        <label for="nascimento" class="block text-sm font-medium text-gray-700 mb-1">Data de Nascimento <span class="text-red-500">*</span></label>
                        <input type="date" id="nascimento" name="nascimento" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition">
                    </div>
                     <div>
                        <label for="telefone" class="block text-sm font-medium text-gray-700 mb-1">Telefone <span class="text-red-500">*</span></label>
                        <input type="tel" id="telefone" name="telefone" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="(00) 00000-0000">
                    </div>
                </div>
            </div>

            <!-- PASSO 2: Inflamação -->
            <div id="step-2" class="step-content hidden bg-white p-6 rounded-2xl shadow-sm mb-6">
                <h2 class="text-2xl font-semibold mb-1">Passo 2: Questionário de Inflamação</h2>
                <p class="text-gray-600 mb-4">Nos últimos 30 dias, como você sentiu os seguintes sintomas?<br><b>Legenda:</b> 0 (Nunca) a 4 (Frequentemente e com grande intensidade).</p>
                <div id="inflammation-questions" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar"></div>
            </div>

            <!-- PASSO 3: Risco Mental -->
            <div id="step-3" class="step-content hidden bg-white p-6 rounded-2xl shadow-sm mb-6">
                 <h2 class="text-2xl font-semibold mb-1">Passo 3: Risco Mental</h2>
                 <p class="text-gray-600 mb-4">Marque "Sim" ou "Não" para cada afirmação abaixo.</p>
                <div id="mental-risk-questions" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar"></div>
            </div>

            <!-- PASSO 4: Resultados -->
            <div id="step-4" class="step-content hidden bg-white p-6 rounded-2xl shadow-sm mt-8 border-t-4 border-cyan-500">
                 <h2 class="text-2xl font-semibold mb-4 text-center">Passo 4: Seus Resultados</h2>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center mb-8">
                    <!-- Resultado Inflamação -->
                    <div id="inflammation-result" class="p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-700">Escore de Inflamação</h3>
                        <p id="inflammation-score" class="text-5xl font-bold my-2"></p>
                        <p id="inflammation-level" class="text-xl font-medium"></p>
                    </div>
                    <!-- Resultado Risco Mental -->
                    <div id="mental-risk-result" class="p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-700">Risco Mental</h3>
                        <p id="mental-risk-score" class="text-5xl font-bold my-2"></p>
                        <p id="mental-risk-level" class="text-xl font-medium"></p>
                    </div>
                 </div>
                 
                 <div class="text-center">
                    <button type="button" onclick="generatePDF()" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 ease-in-out mb-6 w-full sm:w-auto flex items-center justify-center mx-auto gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Baixar Meu Relatório em PDF
                    </button>

                    <p class="mb-4 text-gray-600">Clique abaixo para enviar seus resultados ao Dr. Bruno.</p>
                    <button type="submit" id="submitButton" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all duration-300 ease-in-out">
                        Enviar Resultados
                    </button>
                    <p id="submit-status" class="mt-4 text-sm text-gray-600 h-5"></p>
                 </div>
            </div>

            <!-- Campos ocultos para os escores calculados -->
            <input type="hidden" id="escore_inflamacao" name="escore_inflamacao" value="0">
            <input type="hidden" id="nivel_inflamacao" name="nivel_inflamacao" value="">
            <input type="hidden" id="escore_risco_mental" name="escore_risco_mental" value="0">
            <input type="hidden" id="nivel_risco_mental" name="nivel_risco_mental" value="">

            <!-- Navegação -->
            <div class="flex justify-between items-center mt-8 px-4" id="navigation-container">
                <button type="button" id="prevBtn" class="hidden bg-gray-200 text-gray-700 font-semibold py-2 px-6 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 transition">
                    Anterior
                </button>
                <div class="flex-1"></div>
                <button type="button" id="nextBtn" class="bg-cyan-600 text-white font-bold py-2 px-8 rounded-lg shadow-md hover:bg-cyan-700 focus:outline-none focus:ring-4 focus:ring-cyan-300 transition-all duration-300">
                    Próximo
                </button>
            </div>
        </form>
    </div>

<script>
    /**
     * Gera o PDF com os resultados
     */
    async function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Dados do Formulário
        const nome = document.getElementById('nome').value || "Paciente";
        const dataAtual = new Date().toLocaleDateString('pt-BR');
        const scoreInflamacao = document.getElementById('escore_inflamacao').value;
        const nivelInflamacao = document.getElementById('nivel_inflamacao').value;
        const scoreMental = document.getElementById('escore_risco_mental').value;
        const nivelMental = document.getElementById('nivel_risco_mental').value;

        // --- Cabeçalho ---
        doc.setFontSize(18);
        doc.setTextColor(0, 150, 136); // Cor Teal (similar ao design)
        doc.text("Relatório de Saúde Integrativa", 105, 20, null, null, "center");
        doc.setFontSize(14);
        doc.text("Dr. Bruno Paschoalini", 105, 28, null, null, "center");
        
        // --- Dados do Paciente ---
        doc.setFontSize(12);
        doc.setTextColor(0, 0, 0);
        doc.text(`Paciente: ${nome}`, 20, 45);
        doc.text(`Data: ${dataAtual}`, 150, 45);

        // --- Resumo dos Escores ---
        doc.setDrawColor(0, 150, 136);
        doc.setLineWidth(0.5);
        doc.line(20, 50, 190, 50);
        
        doc.setFontSize(14);
        doc.text("Resumo dos Resultados", 20, 60);
        
        doc.setFontSize(12);
        // Inflamação
        doc.text(`Inflamação:`, 20, 70);
        doc.setFont("helvetica", "bold");
        doc.text(`${scoreInflamacao} - ${nivelInflamacao}`, 50, 70);
        
        // Risco Mental
        doc.setFont("helvetica", "normal");
        doc.text(`Risco Mental:`, 110, 70);
        doc.setFont("helvetica", "bold");
        doc.text(`${scoreMental} - ${nivelMental}`, 140, 70);
        doc.setFont("helvetica", "normal");

        // --- Tabela de Destaques ---
        const rows = [];
        const formData = new FormData(document.getElementById('questionnaireForm'));
        let globalIndex = 0;

        // Processar Inflamação (Valores 3 ou 4)
        inflammationData.forEach(cat => {
            cat.questions.forEach(q => {
                const val = formData.get(`inflamacao_${globalIndex}`);
                if (val && parseInt(val) >= 3) {
                    rows.push([q, "Inflamação", val + "/4 (Alto)"]);
                }
                globalIndex++;
            });
        });

        // Processar Risco Mental (Valor 1 = Sim)
        mentalRiskData.forEach(q => {
            const val = formData.get(`risco_mental_${globalIndex}`);
            if (val && parseInt(val) === 1) {
                rows.push([q, "Risco Mental", "Sim"]);
            }
            globalIndex++;
        });

        if (rows.length > 0) {
            doc.autoTable({
                startY: 80,
                head: [['Sintoma / Fator', 'Categoria', 'Resultado']],
                body: rows,
                theme: 'grid',
                headStyles: { fillColor: [0, 150, 136] },
                styles: { fontSize: 10 },
                columnStyles: {
                    0: { cellWidth: 100 },
                    2: { fontStyle: 'bold', textColor: [220, 53, 69] } // Vermelho para destacar
                }
            });
        } else {
             doc.setFontSize(11);
             doc.setTextColor(0, 128, 0);
             doc.text("Parabéns! Nenhum ponto de atenção grave foi identificado neste questionário.", 20, 90);
        }

        // --- Rodapé ---
        const pageHeight = doc.internal.pageSize.height;
        doc.setFontSize(9);
        doc.setTextColor(128, 128, 128);
        doc.text("Este documento é informativo e não substitui consulta médica.", 105, pageHeight - 10, null, null, "center");

        // Baixar PDF
        doc.save(`Relatorio_DrBruno_${nome.replace(/\s+/g, '_')}.pdf`);
    }

    // --- CONFIGURAÇÃO DE ESTADO ---
    let currentStep = 1;
    const totalSteps = 4;

    // --- DADOS DOS QUESTIONÁRIOS ---
    const inflammationData = [
        { title: "Trato Digestivo", questions: ["Náusea ou vômitos", "Diarréia", "Constipação / prisão de ventre", "Estufamento abdominal", "Arrotos ou gases", "Queimação (azia) no peito", "Dor estomacal / intestinal"] },
        { title: "Energia / Atividade", questions: ["Fadiga ou lentidão", "Apatia, letargia", "Hiperatividade", "Inquietude, dificuldade em relaxar"] },
        { title: "Ouvidos", questions: ["Coceira", "Dor de ouvido ou otites", "Presença de secreção no ouvido", "Zumbido ou perda auditiva"] },
        { title: "Emoções", questions: ["Alterações de humor", "Ansiedade, medo ou nervosismo", "Depressão"] },
        { title: "Olhos", questions: ["Lacrimejando ou coceira ocular", "Olhos inchados/vermelhos/cílios colando", "Bolsas ou olheiras abaixo dos olhos", "Visão borrada ou em túnel"] },
        { title: "Cabeça", questions: ["Dor de cabeça", "Sensação de desmaio", "Tonturas", "Insônia"] },
        { title: "Pulmões", questions: ["Congestão no peito", "Asma, bronquite", "Respiração rápida, pouco fôlego", "Dificuldade de respirar"] },
        { title: "Mente", questions: ["Pouca memória", "Confusão, má compreensão", "Dificuldade de concentração", "Má coordenação motora", "Dificuldade em tomar decisões", "Gagueira ou incoordenação da voz", "Fala arrastada", "Pronúncia de forma confusa", "Dificuldade de aprendizado"] },
        { title: "Articulações / Músculos", questions: ["Dor ou inchaços nas juntas", "Artrite / Artrose", "Rigidez ou limitação de movimento", "Dor ou inchaço muscular", "Sensação de fraqueza ou cansaço"] },
        { title: "Coração", questions: ["Batimentos cardíacos irregulares", "Batidas rápidas demais (Taquicardia)", "Dor torácica"] },
        { title: "Peso", questions: ["Compulsão alimentar / álcool", "Fissura por certos alimentos", "Ganho de peso", "Compulsão alimentar", "Retenção de líquidos", "Perda de peso"] },
        { title: "Nariz", questions: ["Entupido", "Sinusite", "Corrimento nasal, espirros, lacrimejamento e coceira dos olhos", "Ataques de espirro", "Excessiva secreção nasal"] },
        { title: "Pele", questions: ["Acne", "Feridas que coçam, erupções ou pele seca", "Perda de cabelo", "Vermelhidão, calorões", "Suor excessivo"] },
        { title: "Outros", questions: ["Doenças frequentes", "Aumento da frequência ou urgência urinária", "Coceira ou secreção genitais", "Edema / inchaço de mãos / pernas / pés"] },
        { title: "Boca / Garganta", questions: ["Tosse crônica", "Necessidade frequente de limpar a garganta", "Dor de garganta, rouquidão, perda da voz", "Língua, gengiva ou lábios inchados descoloridos ou pálidos", "Aftas"] }
    ];

    const mentalRiskData = [
        "Eu como pão quase diariamente", "Tomo suco de frutas (de qualquer tipo)", "Como mais de três frutas por dia", "Uso adoçante artificial", "Caminho menos de 50 min/dia na maior parte dos dias", "Fico ofegante ao caminhar", "Como pouca salada", "Estou acima do peso (IMC > 24.9)", "Como arroz, massa ou pão à noite", "Tomo leite pasteurizado", "Tenho histórico familiar de problemas neurológicos", "Evito comer gorduras de qualquer tipo", "Tomo remédio para colesterol", "Tomo refrigerante (seja diet ou normal)", "Tomo pouca água (menos de 2 litros por dia)", "Tomo cerveja", "Como cereais (aveia, granola, musli, sucrilhos, trigo, etc)", "Tive problemas auditivos por 10 anos", "Durmo com celular no quarto", "Fumei pelo menos 10 anos", "Tive depressão/ansiedade por 10 anos", "Tomei remédio para dormir por 10 anos", "Ronco à noite e/ou tenho apnéia do sono", "Minha pressão é maior que 120/80 mmHg às vezes", "Meu colesterol HDL é inferior a 50 mg/dl", "Minha vitamina B12 é inferior a 500 pg/ml", "Minha vitamina D é inferior a 50 ng/dl", "Minha glicose é superior a 89 mg/ml", "Minha insulina de jejum é > 6 uU/ml", "Minha homocisteína é > 7 micromol/L", "Meu PCR-us é > 0.7 mg/dL"
    ];

    /**
     * Função auxiliar para criar um elemento HTML
     */
    function createElement(tag, classes = [], text = '') {
        const element = document.createElement(tag);
        if (classes.length) element.classList.add(...classes);
        if (text) element.textContent = text;
        return element;
    }

    /**
     * Inicializa o formulário, criando e inserindo as perguntas na página.
     */
    function initializeForm() {
        const inflammationContainer = document.getElementById('inflammation-questions');
        const mentalRiskContainer = document.getElementById('mental-risk-questions');
        let questionIndex = 0; // Usar um único índice para nomes únicos

        inflammationData.forEach(category => {
            // Título da categoria
            const catTitle = createElement('h3', ['text-lg', 'font-bold', 'text-cyan-700', 'mt-4', 'mb-2'], category.title);
            inflammationContainer.appendChild(catTitle);

            category.questions.forEach(q => {
                const questionWrapper = createElement('div', ['flex', 'flex-col', 'sm:flex-row', 'sm:items-center', 'sm:justify-between', 'py-2', 'border-b', 'border-gray-200', 'last:border-0']);
                const questionName = `inflamacao_${questionIndex}`; 
                const label = createElement('label', ['flex-1', 'mr-4', 'text-sm', 'mb-2', 'sm:mb-0'], q);
                const radioGroup = createElement('div', ['flex', 'items-center', 'space-x-2', 'inflammation-radio']);
                
                for (let i = 0; i <= 4; i++) {
                    const radioId = `q-${questionIndex}-${i}`;
                    const radioInput = createElement('input');
                    radioInput.type = 'radio';
                    radioInput.name = questionName;
                    radioInput.id = radioId;
                    radioInput.value = i;
                    if (i === 0) radioInput.checked = true;
                    
                    const radioLabel = createElement('label', [], i.toString());
                    radioLabel.htmlFor = radioId;
                    
                    radioGroup.append(radioInput, radioLabel);
                }
                questionWrapper.append(label, radioGroup);
                inflammationContainer.appendChild(questionWrapper);
                questionIndex++;
            });
        });

        mentalRiskData.forEach(q => {
            const questionWrapper = createElement('div', ['flex', 'flex-col', 'sm:flex-row', 'sm:items-center', 'sm:justify-between', 'p-3', 'border', 'border-gray-200', 'rounded-lg']);
            const label = createElement('label', ['flex-1', 'mr-4', 'text-sm', 'mb-2', 'sm:mb-0'], q);
            const radioGroup = createElement('div', ['flex', 'items-center', 'space-x-2', 'mental-radio']);
            const questionName = `risco_mental_${questionIndex}`; 

            // Opção "Não"
            const radioNoId = `q-${questionIndex}-0`;
            const radioNoInput = createElement('input');
            radioNoInput.type = 'radio';
            radioNoInput.name = questionName;
            radioNoInput.id = radioNoId;
            radioNoInput.value = '0';
            radioNoInput.checked = true;
            
            const radioNoLabel = createElement('label', [], 'Não');
            radioNoLabel.htmlFor = radioNoId;

            // Opção "Sim"
            const radioYesId = `q-${questionIndex}-1`;
            const radioYesInput = createElement('input');
            radioYesInput.type = 'radio';
            radioYesInput.name = questionName;
            radioYesInput.id = radioYesId;
            radioYesInput.value = '1';
            
            const radioYesLabel = createElement('label', [], 'Sim');
            radioYesLabel.htmlFor = radioYesId;

            radioGroup.append(radioNoInput, radioNoLabel, radioYesInput, radioYesLabel);
            questionWrapper.append(label, radioGroup);
            mentalRiskContainer.appendChild(questionWrapper);
            questionIndex++;
        });
    }

    /**
     * Calcula os escores e atualiza os campos ocultos
     */
    function calculateScores() {
        const form = document.getElementById('questionnaireForm');
        const formData = new FormData(form);
        
        let inflammationTotal = 0;
        let mentalRiskTotal = 0;
        
        // Contar questões de inflamação (começam com 'inflamacao_')
        for (let [key, value] of formData.entries()) {
            if (key.startsWith('inflamacao_')) {
                inflammationTotal += Number(value);
            } else if (key.startsWith('risco_mental_')) {
                mentalRiskTotal += Number(value);
            }
        }

        // Determinar níveis
        let inflammationLevel;
        if (inflammationTotal < 10) inflammationLevel = 'Normal';
        else if (inflammationTotal < 50) inflammationLevel = 'Leve';
        else if (inflammationTotal < 100) inflammationLevel = 'Moderada';
        else inflammationLevel = 'Grave';

        let mentalRiskLevel;
        if (mentalRiskTotal === 0) mentalRiskLevel = 'Ideal';
        else if (mentalRiskTotal <= 9) mentalRiskLevel = 'Leve';
        else if (mentalRiskTotal <= 20) mentalRiskLevel = 'Moderado';
        else mentalRiskLevel = 'Grave';

        // Atualizar campos ocultos
        document.getElementById('escore_inflamacao').value = inflammationTotal;
        document.getElementById('nivel_inflamacao').value = inflammationLevel;
        document.getElementById('escore_risco_mental').value = mentalRiskTotal;
        document.getElementById('nivel_risco_mental').value = mentalRiskLevel;

        return { inflammationTotal, mentalRiskTotal, inflammationLevel, mentalRiskLevel };
    }

    /**
     * Exibe os resultados calculados na tela.
     */
    function displayResults(inflammationTotal, mentalRiskTotal, inflammationLevel, mentalRiskLevel) {
        const inflammationScoreEl = document.getElementById('inflammation-score');
        const inflammationLevelEl = document.getElementById('inflammation-level');
        const inflammationResultEl = document.getElementById('inflammation-result');
        
        let iColorClass;
        if (inflammationTotal < 10) iColorClass = 'bg-green-100 text-green-700';
        else if (inflammationTotal < 50) iColorClass = 'bg-yellow-100 text-yellow-700';
        else if (inflammationTotal < 100) iColorClass = 'bg-orange-100 text-orange-700';
        else iColorClass = 'bg-red-100 text-red-700';

        inflammationScoreEl.textContent = inflammationTotal;
        inflammationLevelEl.textContent = inflammationLevel;
        inflammationResultEl.className = `p-4 rounded-lg ${iColorClass.split(' ')[0]}`;
        inflammationScoreEl.className = `text-5xl font-bold my-2 ${iColorClass.split(' ')[1]}`;

        const mentalRiskScoreEl = document.getElementById('mental-risk-score');
        const mentalRiskLevelEl = document.getElementById('mental-risk-level');
        const mentalRiskResultEl = document.getElementById('mental-risk-result');
        
        let mColorClass;
        if (mentalRiskTotal === 0) mColorClass = 'bg-green-100 text-green-700';
        else if (mentalRiskTotal <= 9) mColorClass = 'bg-yellow-100 text-yellow-700';
        else if (mentalRiskTotal <= 20) mColorClass = 'bg-orange-100 text-orange-700';
        else mColorClass = 'bg-red-100 text-red-700';

        mentalRiskScoreEl.textContent = `${mentalRiskTotal} / ${mentalRiskData.length}`;
        mentalRiskLevelEl.textContent = mentalRiskLevel;
        mentalRiskResultEl.className = `p-4 rounded-lg ${mColorClass.split(' ')[0]}`;
        mentalRiskScoreEl.className = `text-5xl font-bold my-2 ${mColorClass.split(' ')[1]}`;
    }

    // --- FUNÇÕES DE NAVEGAÇÃO E PROGRESSO ---

    function updateProgressBar() {
        const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        
        progressBar.style.width = `${progress}%`;
        progressText.textContent = `${Math.round(progress)}%`;
    }

    function showStep(step) {
        // Esconder todos os passos
        for (let i = 1; i <= totalSteps; i++) {
            const stepEl = document.getElementById(`step-${i}`);
            if (stepEl) {
                stepEl.classList.add('hidden');
            }
        }

        // Mostrar passo atual
        const currentStepEl = document.getElementById(`step-${step}`);
        if (currentStepEl) {
            currentStepEl.classList.remove('hidden');
        }

        // Atualizar botões
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const navContainer = document.getElementById('navigation-container');

        if (step === 1) {
            prevBtn.classList.add('hidden');
            nextBtn.textContent = 'Próximo';
            navContainer.classList.remove('hidden');
        } else if (step === totalSteps) {
            navContainer.classList.add('hidden'); // Esconder botões de navegação no passo final
        } else {
            prevBtn.classList.remove('hidden');
            nextBtn.textContent = step === totalSteps - 1 ? 'Ver Resultados' : 'Próximo';
            navContainer.classList.remove('hidden');
        }

        updateProgressBar();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function validateStep(step) {
        const currentStepEl = document.getElementById(`step-${step}`);
        const inputs = currentStepEl.querySelectorAll('input[required]');
        let isValid = true;

        inputs.forEach(input => {
            if (!input.value) {
                isValid = false;
                input.classList.add('border-red-500', 'ring-1', 'ring-red-500');
                // Remover aviso visual ao digitar
                input.addEventListener('input', () => {
                    input.classList.remove('border-red-500', 'ring-1', 'ring-red-500');
                }, { once: true });
            }
        });

        if (!isValid) {
            alert('Por favor, preencha todos os campos obrigatórios.');
        }

        return isValid;
    }

    function nextStep() {
        if (!validateStep(currentStep)) return;

        if (currentStep < totalSteps) {
            if (currentStep === totalSteps - 1) {
                // Se estiver indo para o passo final, calcular resultados
                const { inflammationTotal, mentalRiskTotal, inflammationLevel, mentalRiskLevel } = calculateScores();
                displayResults(inflammationTotal, mentalRiskTotal, inflammationLevel, mentalRiskLevel);
            }
            currentStep++;
            showStep(currentStep);
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
        }
    }

    // --- LÓGICA PRINCIPAL ---
    document.addEventListener('DOMContentLoaded', () => {
        // 1. Gera o formulário
        initializeForm();
        
        // 2. Inicializa navegação
        showStep(currentStep);

        document.getElementById('nextBtn').addEventListener('click', nextStep);
        document.getElementById('prevBtn').addEventListener('click', prevStep);
        
        // 3. Define o que acontece ao enviar o formulário
        const form = document.getElementById('questionnaireForm');
        const submitButton = document.getElementById('submitButton');
        
        form.addEventListener('submit', async (event) => {
             // O formulário será enviado normalmente para o Formspree
             // Podemos adicionar um estado de "Enviando..."
             submitButton.textContent = 'Enviando...';
             submitButton.disabled = true;
        });
    });
</script>
</body>
</html>
